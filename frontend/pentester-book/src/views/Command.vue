<template>
  <div class="command-page">
    <h1 v-if="loading" class="loading">Loading...</h1>
    <div v-else-if="!command" class="error">Command not found.</div>
    <div v-else>
      <h1 class="command-title">{{ command.name }}</h1>
      <p class="command-description">{{ command.description || "No description available" }}</p>
      <form class="command-form">
        <div
          v-for="(arg, index) in command.arguments"
          :key="index"
          class="form-group"
        >
          <label :for="arg" class="form-label">Enter {{ arg }}</label>
          <input
            v-model="args[arg]"
            :id="arg"
            :placeholder="`Enter ${arg}`"
            class="form-input"
          />
        </div>
      </form>
      <div v-if="generatedCommand" class="command-output">
        <h2>Generated Command:</h2>
        <code class="command-code">{{ generatedCommand }}</code>
      </div>
    </div>
  </div>
</template>

<script>
import { computed, ref, watchEffect } from "vue";
import { useStore } from "vuex";
import { useRoute } from "vue-router";

export default {
  name: "CommandPage",
  setup() {
    const store = useStore();
    const route = useRoute();
    const args = ref({});
    const generatedCommand = ref("");

    const command = computed(() => store.getters.getCommandDetails(route.params.id));
    const loading = ref(true);

    watchEffect(async () => {
      loading.value = true;

      if (!command.value) {
        console.log("Fetching command details for ID:", route.params.id);
        await store.dispatch("fetchCommandDetails", route.params.id);
      }

      loading.value = false;
    });

    // Automatically generate the command when args change
    watchEffect(() => {
      if (command.value) {
        generatedCommand.value = command.value.template.replace(
          /\{\{(\w+)\}\}/g,
          (_, key) => args.value[key] || ""
        );
      }
    });

    return {
      command,
      args,
      generatedCommand,
      loading,
    };
  },
};
</script>

<style scoped>
.command-page {
  padding: 20px;
  background-color: #121212;
  color: #e0e0e0;
}

.loading,
.error {
  text-align: center;
  font-size: 1.2rem;
  color: #ff6f61;
}

.command-title {
  font-size: 2rem;
  margin-bottom: 10px;
}

.command-description {
  margin-bottom: 20px;
  font-size: 1.1rem;
  color: #aaaaaa;
}

.command-form {
  margin-bottom: 20px;
}

.form-group {
  margin-bottom: 15px;
}

.form-label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
  color: #81d4fa;
}

.form-input {
  width: 100%;
  padding: 10px;
  border: 1px solid #383838;
  border-radius: 5px;
  background-color: #292929;
  color: #e0e0e0;
  font-size: 1rem;
}

.form-input::placeholder {
  color: #aaaaaa;
}

.form-input:focus {
  outline: none;
  border-color: #81d4fa;
  box-shadow: 0 0 5px rgba(129, 212, 250, 0.5);
}

.command-output {
  padding: 15px;
  background-color: #292929;
  border-radius: 5px;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
}

.command-code {
  display: block;
  padding: 10px;
  background-color: #1e1e1e;
  color: #81d4fa;
  font-family: monospace;
  font-size: 1rem;
  word-wrap: break-word;
  border-radius: 5px;
}
</style>
