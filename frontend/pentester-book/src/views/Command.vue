<template>
  <div>
    <h1 v-if="loading">Loading...</h1>
    <div v-else-if="!command">Command not found.</div>
    <div v-else>
      <h1>{{ command.Name }}</h1>
      <p>{{ command.Descripton }}</p>
      <form @submit.prevent="generateCommand">
        <div v-for="(arg, index) in command.Args" :key="index">
          <label :for="arg">Argument {{ index + 1 }}</label>
          <input
            v-model="args[arg]"
            :placeholder="'Enter ' + arg"
            :id="arg"
          />
        </div>
        <button type="submit">Generate</button>
      </form>
      <div v-if="generatedCommand">
        <h2>Generated Command:</h2>
        <code>{{ generatedCommand }}</code>
      </div>
    </div>
  </div>
</template>

<script>
import { computed, ref, onMounted } from "vue";
import { useStore } from "vuex";
import { useRoute } from "vue-router";

export default {
  name: "CommandPage",
  setup() {
    const store = useStore();
    const route = useRoute();
    const args = ref({});
    const generatedCommand = ref("");

    // Используем Vuex геттер для получения данных команды
    const command = computed(() =>
      store.getters.getCommandDetails(route.params.id)
    );

    // Состояние загрузки
    const loading = ref(true);

    // Загружаем данные команды, если они отсутствуют
    onMounted(async () => {
      if (!command.value) {
        await store.dispatch("fetchCommandDetails", route.params.id);
      }
      loading.value = false;
    });

    const generateCommand = () => {
      if (command.value) {
        // Заменяем плейсхолдеры аргументами в шаблоне
        generatedCommand.value = command.value.Template.replace(
          /\{\{(\w+)\}\}/g,
          (_, key) => args.value[key] || ""
        );
      }
    };

    return {
      command,
      args,
      generatedCommand,
      generateCommand,
      loading,
    };
  },
};
</script>
