<template>
  <div>
    <h1 v-if="loading">Loading...</h1>
    <div v-else-if="!command">Command not found.</div>
    <div v-else>
      <h1>{{ command.name }}</h1>
      <p>{{ command.description }}</p>
      <form @submit.prevent="generateCommand">
        <div v-for="arg in command.arguments" :key="arg.name">
          <label :for="arg.name">{{ arg.label }}</label>
          <input v-model="args[arg.name]" :placeholder="arg.placeholder" />
        </div>
        <button type="submit">Generate</button>
      </form>
      <div v-if="generatedCommand">
        <h2>Generated Command:</h2>
        <code>{{ generatedCommand }}</code>
      </div>
    </div>
  </div>
</template>

<script>
import { computed, ref, onMounted } from "vue";
import { useStore } from "vuex";
import { useRoute } from "vue-router";

export default {
  name: "CommandPage",
  setup() {
    const store = useStore();
    const route = useRoute();
    const args = ref({});
    const generatedCommand = ref("");

    // Используем getCommandById для извлечения данных команды из кэша
    const command = computed(() => store.getters.getCommandById(route.params.id));

    // Загрузка состояния - проверка наличия данных для команды в кэше
    const loading = computed(() => !command.value);

    // Если данных команды нет, загружаем их
    onMounted(async () => {
      if (!command.value) {
        await store.dispatch("fetchCommandData", route.params.id);
      }
    });

    const generateCommand = () => {
      if (command.value) {
        // Заменяем шаблон аргументами
        generatedCommand.value = command.value.template.replace(
          /\{\{(\w+)\}\}/g,
          (_, key) => args.value[key] || ""
        );
      }
    };

    return {
      command,
      args,
      generatedCommand,
      generateCommand,https://github.com/knockoutNoN13/WorldScanner
      loading,
    };
  },
};
</script>
