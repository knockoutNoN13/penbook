<template>
  <div>
    <h1 v-if="loading">Loading...</h1>
    <div v-else-if="!command">Command not found.</div>
    <div v-else>
      <h1>{{ command.name }}</h1>
      <p>{{ command.description || "No description available" }}</p>
      <form @submit.prevent="generateCommand">
        <div v-for="(arg, index) in command.arguments" :key="index">
          <label :for="arg">Enter {{ arg }}</label>
          <input v-model="args[arg]" :id="arg" :placeholder="`Enter ${arg}`" />
        </div>
        <button type="submit">Generate</button>
      </form>
      <div v-if="generatedCommand">
        <h2>Generated Command:</h2>
        <code>{{ generatedCommand }}</code>
      </div>
    </div>
  </div>
</template>

<script>
import { computed, ref, watchEffect } from "vue";
import { useStore } from "vuex";
import { useRoute } from "vue-router";

export default {
  name: "CommandPage",
  setup() {
    const store = useStore();
    const route = useRoute();
    const args = ref({});
    const generatedCommand = ref("");

    const command = computed(() => store.getters.getCommandDetails(route.params.id));
    const loading = ref(true);

    watchEffect(async () => {
      loading.value = true;

      if (!command.value) {
        console.log("Fetching command details for ID:", route.params.id);
        await store.dispatch("fetchCommandDetails", route.params.id);
      }

      loading.value = false;
    });

    const generateCommand = () => {
      if (command.value) {
        generatedCommand.value = command.value.template.replace(
          /\{\{(\w+)\}\}/g,
          (_, key) => args.value[key] || ""
        );
      }
    };

    return {
      command,
      args,
      generatedCommand,
      generateCommand,
      loading,
    };
  },
};
</script>
